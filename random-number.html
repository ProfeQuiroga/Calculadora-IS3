<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<title>The Number Game</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="css/bootstrap-responsive.css">
	</head>
    <body>
        <div class="row">
            <div class="col-sm-6">
                <h1>The Number Game</h1>
            </div>
        </div>

		<div class="row">
            <div class="col-sm-6">
                <h2><i><a href="index.html">//testsheepnz.github.io/</a></i></h2>
            </div>
        </div>


		<form id="ruleList" class="form-horizontal" method="post" action="">
			<p>
			<div class="row">
				<div class="col-sm-6">
					<p><a href="instructions.html">Instructions here.</a> Choose a build to test ...</p>
					<i>
						<p>
						This page simulates rolling a pair of 6-sided dice to generate a random number.<br />
						Guess the number - you'll be told "correct", "too high", "too low" or "not a number".
					</p></i>
				</div>
			</div>
		</form>



        <form id="setGameForm" class="form-horizontal" method="post" action="">
            <div class="row">

                <div class="col-sm-2">
                    <label class="description" id="buildID" for="buildNumber">Select build:</label>
                </div>
                <div class="col-sm-2">
                    <select style="font-size:25px;" class="element select medium" id="buildNumber" name="buildNumber" onchange="selectBuild(this.preset)">
                        <option value="-1"></option>
                        <option value="0">Demo</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                    </select>
                </div>


            </div>
            <p>
        </form>

        <form id="rollDiceForm" class="form-horizontal" method="post" action="" hidden>
            <div class="row">
                <div class="col-sm-2">
                    <label class="description" id="gameSelected">Game selected</label>
                </div>
                <div class="col-sm-2">
                    <input type="button" class="btn btn-primary" id="rollDiceButton" value="Roll the dice" onClick="rollDice()">
                </div>

            </div>
            <p>

                <div class="row" id="rollDiceRow" hidden>
                    <div class="col-sm-2">
                        <label class="description" id="rollDiceLabel">Rolling dice ...</label>
                    </div>
                    <div class="col-sm-2" id="rollDiceGif">
                        <img src="img/rolling_dice.gif">
                    </div>
                </div>
        </form>

        <form id="numGuessForm" class="form-horizontal" method="post" action="" hidden>

            <div class="row">
                <div class="col-sm-4">
                    <label class="description" id="Game selected">Guess the number...</label>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-2">
                    <label class="description" id="turnNumber">Turn: 0</label>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-2">
                    <input id="numberGuess" name="numberGuess" class="element text medium" type="text" maxlength="6" value="" onkeydown="return (event.keyCode!=13);" />
                </div>

                <div class="col-sm-2">
                    <input type="button" class="btn btn-primary" id="submitButton" value="Submit" onClick="submitNumber()">
                </div>
            </div>
            <p>

            <div class="row">
                <div class="col-sm-4">
                    <label class="description" id="feedbackLabel" value=""></label>
                </div>
            </div>

            <div class="row" hidden>
                <div class="col-sm-6">
                    <textarea id="logForm" rows="10" cols="50"></textarea>
                </div>
            </div>
			<p>
            
            <div class="row">
                <div class="col-sm-6">
                    <a href="https://github.com/TestSheepNZ/TestSheepNZ.github.io/issues">GitHub issues register</a>
                </div>
            </div>
            <p>  
        </form>

        <script>

            var buildSelected = -1;
            var targetNumber = 0;
            var debugOn = true;
            var numTurns = 1;

            /* Build notes
            1	Everyone a winner
            2	Offset value
            3	Floating number
            4	Misdirection
            5	Moving target
            6	Text error
            7	Sweet as
            8	Dice 1 times 2
            9	Programmed response
            10	Odd always low, even always high
            11	8 sided dice
            12	Dice concatinated
            13	Unstable
            */



            function logAction(logEvent) {
                console.log(logEvent);
                if (debugOn) {
                    var originalText = document.getElementById('logForm').value;
                    document.getElementById('logForm').value = originalText + logEvent + "\n";
                }
            }

            function selectBuild(buildNum) {
                buildSelected = document.getElementById('buildNumber').value;

                if (buildSelected == -1) {
                    document.getElementById('rollDiceForm').hidden = true;
                    document.getElementById('numGuessForm').hidden = true;
                } else {
                    document.getElementById('rollDiceForm').hidden = false;
                    document.getElementById('rollDiceButton').value = "Roll the dice";
                    document.getElementById('numGuessForm').hidden = true;
                }
            }

            function restoreButtons() {
                document.getElementById('rollDiceButton').value = "Re-roll";
                document.getElementById('rollDiceButton').disabled = false;
                document.getElementById('rollDiceRow').hidden = true;
            }

            function rollOneDice() {
                var randomNumber = Math.random();
                var scaledNumber, returnValue;

                if (buildSelected == 11) {
                    scaledNumber = +randomNumber * 8.0;
                } else {
                    scaledNumber = +randomNumber * 6.0;
                }

                if (buildSelected != 2) {
                    scaledNumber = +scaledNumber + 1.0;
                }

                if (buildSelected != 3) {
                    returnValue = parseInt(+scaledNumber);
                } else {
                    returnValue = +scaledNumber;
                }

                return returnValue;
            }

            function rollDice() {
                document.getElementById('rollDiceButton').disabled = true;
                document.getElementById('rollDiceRow').hidden = false;
                document.getElementById('numGuessForm').hidden = true;
                document.getElementById('logForm').value = "";
                document.getElementById('feedbackLabel').innerHTML = " ";

                var dice1, dice2;

                dice1 = rollOneDice();
                dice2 = rollOneDice();

                logAction("Dice One: " + dice1 + ", Dice Two: " + dice2);

                if (buildSelected == 8) {
                    targetNumber = +dice1 + +dice1;

                } else if (buildSelected == 12) {
                    targetNumber = "" + dice1 + dice2;
                } else {
                    targetNumber = +dice1 + +dice2;
                }
                numTurns = 1;

                logAction("Target number: " + targetNumber);
                document.getElementById('rollDiceButton').value = "Re-roll";
                document.getElementById('rollDiceButton').disabled = false;
                document.getElementById('turnNumber').innerHTML = "Turn: " + numTurns;
                setTimeout(function () {
                    document.getElementById('rollDiceRow').hidden = true;
                    document.getElementById('numGuessForm').hidden = false;
                    document.getElementById('submitButton').disabled = false;
                    document.getElementById('numberGuess').value = "";
                }, 1000);


                if (buildSelected == 13) {
                    setTimeout(function () {
                        logAction("Browser error ... restart");
						document.getElementById('buildNumber').value = -1;
                        window.location.reload(false);
                    }, 8000);
                }
            }

            function giveFeedback(feedbackString, errorMsg) {
                var fontSet;
                if (errorMsg) {
                    fontSet = "<font size=\"+2\" color=\"red\">";
                } else {
                    fontSet = "<font size=\"+2\" color=\"black\">";
                }
                document.getElementById('feedbackLabel').innerHTML = fontSet + "<b><i>" + feedbackString + "</i></b></font>";
                logAction(feedbackString);
            }

            function crashBrowser(errorMsg) {
                giveFeedback(errorMsg, true);
                setTimeout(function () {
					document.getElementById('buildNumber').value = -1;
                    window.location.reload(false);
                }, 2000);
            }



            function submitNumber() {
                var guess = document.getElementById('numberGuess').value;
                document.getElementById('submitButton').disabled = true;

                if (buildSelected == 1) {
                    giveFeedback("Correct, it took " + numTurns + " turns!", false);
                    return;
                }

                if (buildSelected != 9) {

                    if (isNaN(guess)) {
                        if (buildSelected == 6) {
                            crashBrowser("Error: NaN not handled, restart", false);
                        } else {
                            giveFeedback(guess + ": Not a number!", true);
                        }
                    } else {
                        if (buildSelected == 6 && guess >= 32000) {
                            crashBrowser("Error: Integer overflow, restart", false);
                            return;
                        }

                        if (guess == targetNumber) {
                            giveFeedback("Correct, it took " + numTurns + " turns!", false);
                            return;
                        } else {
                            var tooHighText, tooLowText;
                            if (buildSelected == 4) {
                                tooLowText = ": Too high!";
                                tooHighText = ": Too low!";
                            } else {
                                tooHighText = ": Too high!";
                                tooLowText = ": Too low!";
                            }

                            if (buildSelected == 10) {
                                if ((guess % 2) == 0) {
                                    giveFeedback(guess + tooHighText, true);
                                } else {
                                    giveFeedback(guess + tooLowText, true);
                                }
                            } else {
                                if (guess > targetNumber) {
                                    giveFeedback(guess + tooHighText, true);
                                } else {
                                    giveFeedback(guess + tooLowText, true);
                                }
                            }
                        }
                    }
                } else {
                    var tooHighText, tooLowText;
                    tooHighText = ": Too high!";
                    tooLowText = ": Too low!";

                    switch (numTurns) {
                        case 1:
                            giveFeedback(guess + tooHighText, true);
                            break;
                        case 2:
                            giveFeedback(guess + tooLowText, true);
                            break;
                        case 3:
                            giveFeedback("Correct, it took " + numTurns + " turns!", false);
                            return;
                    }
                }

                if (buildSelected == 5) {
                    targetNumber++;
                }
                document.getElementById('submitButton').disabled = false;
                numTurns++;
                document.getElementById('turnNumber').innerHTML = "Turn: " + numTurns;
                document.getElementById('numberGuess').value = "";
            }


        </script>

    </body>
</html>


